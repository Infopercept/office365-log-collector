# Add this to /home/ubuntu/new-siem/ocsf-siem-deployment/docker-compose.yml
# under the "services:" section

  office365-collector:
    build:
      context: /home/ubuntu/new-siem/office365-audit-log-collector
      dockerfile: Dockerfile
    image: office365-audit-log-collector:latest
    container_name: office365-collector
    hostname: office365-collector
    restart: unless-stopped
    volumes:
      # Config file (create this with your credentials)
      - /home/ubuntu/new-siem/office365-audit-log-collector/config.production.yaml:/app/config.yaml:ro
      # Output directory (shared with Vector via host mount)
      - /var/logs/office365:/var/logs/office365
    networks:
      - ocsf-pipeline
    environment:
      - RUST_LOG=info
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: '0.5'
        reservations:
          memory: 256M
          cpus: '0.25'
    healthcheck:
      test: ["CMD", "test", "-f", "/var/logs/office365/office365.json"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
